<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Auth</title>
    <script src="bot.js"></script>
    <style>
        .loading {
            text-align: center;
            padding: 50px;
            font-family: Arial, sans-serif;
        }
        .error {
            color: red;
            text-align: center;
            padding: 20px;
        }
        .delete-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <h2>Авторизация...</h2>
        <p>Пожалуйста, подождите</p>
    </div>
    
    <div id="error" class="error" style="display: none;">
        <h2>Ошибка авторизации</h2>
        <p id="error-message"></p>
        <button onclick="window.location.href='/'">Вернуться на главную</button>
    </div>

    <script>
        // Функция для получения параметров из URL
        function getUrlParams() {
            const params = {};
            const queryString = window.location.hash.substring(1);
            const regex = /([^&=]+)=([^&]*)/g;
            let m;
            
            while (m = regex.exec(queryString)) {
                params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
            }
            
            return params;
        }

        // Обработка данных авторизации
        async function processAuth() {
            try {
                const params = getUrlParams();
                
                if (params.id) {
                    const user = {
                        id: parseInt(params.id),
                        first_name: params.first_name || '',
                        last_name: params.last_name || '',
                        username: params.username || '',
                        photo_url: params.photo_url || '',
                        auth_date: parseInt(params.auth_date),
                        hash: params.hash
                    };
                    
                    await handleTelegramAuth(user);
                } else {
                    throw new Error('Не удалось получить данные пользователя');
                }
            } catch (error) {
                console.error('Auth processing error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error-message').textContent = error.message;
            }
        }

        // Запускаем обработку при загрузке страницы
        document.addEventListener('DOMContentLoaded', processAuth);
    </script>
</body>
</html>